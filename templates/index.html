<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evvie Time Tracker</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/theme.js"></script>
</head>
<body>
    <!-- Dark mode toggle button -->
    <button class="theme-toggle" id="theme-toggle" data-tooltip="Toggle dark mode">
        <div class="theme-toggle-icon">
            <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M12 17.5C9.5 17.5 7.5 15.5 7.5 13S9.5 8.5 12 8.5 16.5 10.5 16.5 13 14.5 17.5 12 17.5M12 7C8.7 7 6 9.7 6 13S8.7 19 12 19 18 16.3 18 13 15.3 7 12 7M12 2L14.4 6.4L19 5.7L16.2 9.8L18.6 14L14 12.7L9.4 14L11.8 9.8L9 5.7L13.6 6.4L12 2Z"/>
            </svg>
            <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"/>
            </svg>
        </div>
    </button>
    
    <div class="container">
        <header>
            <h1>Evvie Time Tracker</h1>
            <nav>
                <button id="btn-dashboard" class="nav-btn active">Dashboard</button>
                <button id="btn-exclusions" class="nav-btn">Exclusions</button>
                <button id="btn-employees" class="nav-btn">Employees</button>
                <button id="btn-children" class="nav-btn">Children</button>
                <button id="btn-budget" class="nav-btn">Budget</button>
                <button id="btn-forecast" class="nav-btn">Forecast</button>
                <button id="btn-import" class="nav-btn">Import CSV</button>
                <button id="btn-export" class="nav-btn">Export</button>
                <button id="btn-config" class="nav-btn">Settings</button>
            </nav>
        </header>

        <main>
            <div id="dashboard-view" class="view active">
                <div class="period-controls">
                    <button id="prev-period" class="btn-secondary">&lt; Previous</button>
                    <h2 id="period-label">Loading...</h2>
                    <button id="next-period" class="btn-secondary">Next &gt;</button>
                    <div class="child-selector">
                        <label for="child-filter">Child:</label>
                        <select id="child-filter"></select>
                    </div>
                </div>
                <div id="calendar-grid" class="calendar-grid">
                </div>
                <div id="period-summary" class="summary">
                </div>
                <div id="overlap-detection" class="overlap-section">
                </div>
            </div>

            <div id="exclusions-view" class="view">
                <div class="exclusions-container">
                    <div class="exclusions-header">
                        <h2>Exclusion Periods</h2>
                        <p class="exclusions-description">Define periods when manual shift entry should be blocked (e.g., when data is imported from external system)</p>
                        <div class="exclusion-buttons">
                            <button id="add-exclusion" class="btn-primary">Add Exclusion Period</button>
                            <button id="bulk-add-exclusions" class="btn-primary">Bulk Add Exclusions</button>
                        </div>
                        <div class="exclusion-filters">
                            <label class="checkbox-label">
                                <input type="checkbox" id="filter-future-exclusions" checked>
                                <span>Hide exclusions after current period</span>
                            </label>
                        </div>
                    </div>
                    <div class="exclusions-table-wrapper">
                        <table id="exclusions-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Applies To</th>
                                    <th>Start Date/Time</th>
                                    <th>End Date/Time</th>
                                    <th>Reason</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="employees-view" class="view">
                <div class="page-container">
                    <div class="page-header">
                        <h2>Employees</h2>
                        <button id="add-employee" class="btn-primary">Add Employee</button>
                    </div>
                    <div class="table-wrapper">
                        <table id="employees-table">
                            <thead>
                                <tr>
                                    <th>Friendly Name</th>
                                    <th>System Name</th>
                                    <th>Status</th>
                                    <th>Hidden</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="children-view" class="view">
                <div class="page-container">
                    <div class="page-header">
                        <h2>Children</h2>
                        <button id="add-child" class="btn-primary">Add Child</button>
                    </div>
                    <div class="table-wrapper">
                        <table id="children-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Code</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="import-view" class="view">
                <div class="page-container">
                    <div class="page-header">
                        <h2>Import CSV</h2>
                    </div>
                    <div class="import-form">
                        <input type="file" id="csv-file" accept=".csv" multiple>
                        <button id="validate-csv" class="btn-secondary">Validate Files</button>
                        <button id="import-csv" class="btn-primary">Import Files</button>
                    </div>
                    <div id="import-loading" class="import-loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Import in progress, please wait...</p>
                    </div>
                    <div id="import-results"></div>
                </div>
            </div>

            <div id="export-view" class="view">
                <div class="page-container">
                    <div class="page-header">
                        <h2>Export Data</h2>
                    </div>
                    <div class="export-form">
                        <label>
                            Start Date:
                            <input type="date" id="export-start">
                        </label>
                        <label>
                            End Date:
                            <input type="date" id="export-end">
                        </label>
                        <div class="export-buttons">
                            <button id="export-pdf" class="btn-primary">Export PDF</button>
                            <button id="export-csv" class="btn-primary">Export CSV</button>
                            <button id="export-json" class="btn-primary">Export JSON</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="budget-view" class="view">
                <div class="page-container">
                    <div class="page-header">
                        <h2>Budget Management</h2>
                    </div>
                    <div class="budget-tabs">
                    <button class="tab-btn active" data-tab="reports">PDF Reports</button>
                    <button class="tab-btn" data-tab="budgets">Child Budgets</button>
                    <button class="tab-btn" data-tab="rates">Employee Rates</button>
                    <button class="tab-btn" data-tab="allocations">Allocations</button>
                    <button class="tab-btn" data-tab="utilization">Utilization</button>
                </div>
                
                <!-- PDF Reports Tab -->
                <div id="reports-tab" class="tab-content active">
                    <div class="reports-controls">
                        <button id="upload-pdf-report" class="btn-primary">Upload PDF Report</button>
                        <input type="file" id="pdf-report-file" accept=".pdf" style="display: none;">
                        <button id="refresh-reports" class="btn-secondary">Refresh</button>
                    </div>
                    <div id="report-upload-result" class="upload-result" style="display: none;"></div>
                    <h3>Report History</h3>
                    <table id="reports-table">
                        <thead>
                            <tr>
                                <th>Report Date</th>
                                <th>Child</th>
                                <th>Period</th>
                                <th>Total Budget</th>
                                <th>Total Spent</th>
                                <th>Utilization</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div id="report-details" class="report-details" style="display: none;"></div>
                </div>
                
                <!-- Child Budgets Tab -->
                <div id="budgets-tab" class="tab-content">
                    <div class="budget-controls">
                        <button id="add-budget" class="btn-primary">Add Budget</button>
                        <button id="import-budgets" class="btn-secondary">Import CSV</button>
                        <input type="file" id="budget-csv-file" accept=".csv" style="display: none;">
                        <button id="refresh-budgets" class="btn-secondary">Refresh</button>
                    </div>
                    <div id="budget-form" class="form-container" style="display: none;">
                        <h3>Add/Edit Child Budget</h3>
                        <form id="child-budget-form">
                            <input type="hidden" id="budget-id">
                            <label>Child:
                                <select id="budget-child" required></select>
                            </label>
                            <label>Period Start:
                                <input type="date" id="budget-start" required>
                            </label>
                            <label>Period End:
                                <input type="date" id="budget-end" required>
                            </label>
                            <label>Budget Amount ($):
                                <input type="number" id="budget-amount" step="0.01" min="0" required>
                            </label>
                            <label>Budget Hours:
                                <input type="number" id="budget-hours" step="0.01" min="0">
                            </label>
                            <label>Notes:
                                <textarea id="budget-notes" rows="3"></textarea>
                            </label>
                            <div class="form-buttons">
                                <button type="submit" class="btn-primary">Save</button>
                                <button type="button" id="cancel-budget" class="btn-secondary">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <table id="budgets-table">
                        <thead>
                            <tr>
                                <th>Child</th>
                                <th>Period</th>
                                <th>Budget Amount</th>
                                <th>Budget Hours</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <!-- Employee Rates Tab -->
                <div id="rates-tab" class="tab-content">
                    <div class="rates-controls">
                        <button id="add-rate" class="btn-primary">Add Rate</button>
                        <button id="refresh-rates" class="btn-secondary">Refresh</button>
                    </div>
                    <div id="rate-form" class="form-container" style="display: none;">
                        <h3>Add/Edit Employee Rate</h3>
                        <form id="employee-rate-form">
                            <input type="hidden" id="rate-id">
                            <label>Employee:
                                <select id="rate-employee" required></select>
                            </label>
                            <label>Hourly Rate ($):
                                <input type="number" id="rate-amount" step="0.01" min="0" required>
                            </label>
                            <label>Effective Date:
                                <input type="date" id="rate-effective" required>
                            </label>
                            <label>End Date (optional):
                                <input type="date" id="rate-end">
                            </label>
                            <label>Notes:
                                <textarea id="rate-notes" rows="3"></textarea>
                            </label>
                            <div class="form-buttons">
                                <button type="submit" class="btn-primary">Save</button>
                                <button type="button" id="cancel-rate" class="btn-secondary">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <table id="rates-table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Hourly Rate</th>
                                <th>Effective Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <!-- Allocations Tab -->
                <div id="allocations-tab" class="tab-content">
                    <div class="allocation-controls">
                        <label>Payroll Period:
                            <select id="allocation-period"></select>
                        </label>
                        <button id="add-allocation" class="btn-primary">Add Allocation</button>
                        <button id="refresh-allocations" class="btn-secondary">Refresh</button>
                    </div>
                    <div id="allocation-form" class="form-container" style="display: none;">
                        <h3>Add/Edit Budget Allocation</h3>
                        <form id="budget-allocation-form">
                            <input type="hidden" id="allocation-id">
                            <label>Child:
                                <select id="allocation-child" required></select>
                            </label>
                            <label>Employee:
                                <select id="allocation-employee" required></select>
                            </label>
                            <label>Allocated Hours:
                                <input type="number" id="allocation-hours" step="0.01" min="0" required>
                            </label>
                            <label>Notes:
                                <textarea id="allocation-notes" rows="3"></textarea>
                            </label>
                            <div class="form-buttons">
                                <button type="submit" class="btn-primary">Save</button>
                                <button type="button" id="cancel-allocation" class="btn-secondary">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <table id="allocations-table">
                        <thead>
                            <tr>
                                <th>Child</th>
                                <th>Employee</th>
                                <th>Allocated Hours</th>
                                <th>Estimated Cost</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <!-- Utilization Tab -->
                <div id="utilization-tab" class="tab-content">
                    <div class="utilization-controls">
                        <label>Period:
                            <input type="date" id="util-start">
                        </label>
                        <label>to
                            <input type="date" id="util-end">
                        </label>
                        <button id="refresh-utilization" class="btn-primary">Refresh</button>
                    </div>
                    <div id="utilization-dashboard">
                        <div class="util-summary" id="util-summary"></div>
                        <div class="util-charts" id="util-charts"></div>
                        <table id="utilization-table">
                            <thead>
                                <tr>
                                    <th>Child</th>
                                    <th>Budget</th>
                                    <th>Spent</th>
                                    <th>Remaining</th>
                                    <th>Utilization %</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                </div>
            </div>

            <div id="forecast-view" class="view">
                <div class="page-container">
                    <div class="page-header">
                        <h2>Hour Forecasting</h2>
                    </div>
                    <div class="forecast-tabs">
                        <button class="tab-btn active" data-tab="available-hours">Available Hours</button>
                        <button class="tab-btn" data-tab="patterns">Historical Patterns</button>
                        <button class="tab-btn" data-tab="projections">Projections</button>
                    </div>
                    <div id="available-hours-tab" class="tab-content active">
                    <div class="forecast-controls">
                        <label>Period:
                            <input type="date" id="forecast-start">
                        </label>
                        <label>to
                            <input type="date" id="forecast-end">
                        </label>
                        <button id="refresh-forecast" class="btn-primary">Refresh</button>
                    </div>
                    <div id="available-hours-cards" class="forecast-cards"></div>
                </div>
                <div id="patterns-tab" class="tab-content">
                    <div class="pattern-controls">
                        <label>Child:
                            <select id="pattern-child"></select>
                        </label>
                        <label>Lookback Days:
                            <input type="number" id="lookback-days" value="90" min="7" max="365">
                        </label>
                        <button id="analyze-patterns" class="btn-primary">Analyze</button>
                    </div>
                    <div id="patterns-display"></div>
                </div>
                <div id="projections-tab" class="tab-content">
                    <div class="projection-controls">
                        <label>Child:
                            <select id="projection-child"></select>
                        </label>
                        <label>Projection Days:
                            <input type="number" id="projection-days" value="30" min="7" max="90">
                        </label>
                        <button id="generate-projection" class="btn-primary">Generate</button>
                    </div>
                    <div id="projections-display"></div>
                </div>
                </div>
            </div>

            <div id="config-view" class="view">
                <h2>Settings</h2>
                <div class="config-section">
                    <h3>Payroll Period Configuration</h3>
                    <label>
                        Anchor Date (First Period Start):
                        <input type="date" id="anchor-date">
                        <button id="configure-periods" class="btn-primary">Configure</button>
                    </label>
                </div>
                <div class="config-section">
                    <h3>Hour Limits</h3>
                    <button id="add-hour-limit" class="btn-primary">Add Hour Limit</button>
                    <table id="hour-limits-table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Child</th>
                                <th>Max Hours/Week</th>
                                <th>Alert Threshold</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script src="/static/js/app.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/exclusions.js"></script>
    <script src="/static/js/employees.js"></script>
    <script src="/static/js/children.js"></script>
    <script src="/static/js/shifts.js"></script>
    <script src="/static/js/import-export.js"></script>
    <script src="/static/js/forms.js"></script>
    <script src="/static/js/config.js"></script>
    <script src="/static/js/budget.js"></script>
    <script src="/static/js/forecast.js"></script>
</body>
</html>